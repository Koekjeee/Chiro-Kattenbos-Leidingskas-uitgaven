<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Onkostennota ‚Äì Chiro Kattenbos</title>
  <link rel="stylesheet" href="style.css?v=20250926" />
  <meta name="theme-color" content="#111827" />
  <!-- PWA links removed here to avoid 404s on GitHub Pages path; can be re-added when assets are present -->

  <!-- Firebase SDKs (compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-storage-compat.js"></script>

  <!-- jsPDF + autotable -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>

  <script>
    // Zelfde Firebase config als index.html
    const firebaseConfig = {
      apiKey: "AIzaSyC-UaXhh5juhV4raXWnzku9fSZZD75-y9w",
      authDomain: "uitgavebeheerch.firebaseapp.com",
      databaseURL: "https://uitgavebeheerch-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "uitgavebeheerch",
  // Correcte bucket (voorheen verkeerd domein waardoor CORS / preflight faalde)
  storageBucket: "uitgavebeheerch.appspot.com",
      messagingSenderId: "461673562296",
      appId: "1:461673562296:web:d90a026cd685400139f44d",
      measurementId: "G-K8NYLSE5EF"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

  // Theme helpers
  function applyTheme(theme){
    const b = document.body;
    if (!b) return;
    if (!b.dataset) b.dataset = {};
    b.dataset.theme = theme;
  }
  async function saveThemePreference(theme){ try { localStorage.setItem('theme', theme); } catch {} }
  // Apply theme immediately if body exists; otherwise set after DOMContentLoaded
  const __initTheme = localStorage.getItem('theme') || 'dark';
  if (document.body) applyTheme(__initTheme);

  // Helpers
    function parseEuro(str){
      if (typeof str !== 'string') return NaN;
      const clean = str.trim().replace(/\s/g,'').replace(/\.(?=\d{3}(\D|$))/g,'').replace(',', '.');
      return Number(clean);
    }
    function formatEuro(v){
      return new Intl.NumberFormat('nl-BE',{ style:'currency', currency:'EUR' }).format(+v || 0);
    }

    const LEIDINGSKAS_IBAN = 'BE38 7350 3401 6672';
    const CHIRO_NAAM = 'Chiro Kattenbos';
    const CHIRO_ADRES = 'Oude Diestersebaan 1A, 3920 Lommel';

    function generateLocalReference(){
      const jaar = new Date().getFullYear();
      // Timestamp + random om botsingen te vermijden zonder server
      const rand = Math.floor(100 + Math.random()*900);
      const ts = Date.now().toString().slice(-4); // laatste 4 cijfers
      const refStr = `${jaar}-${ts}${rand}`; // bv 2025-5823123
      const el = document.getElementById('referentie');
      if (el) el.value = refStr;
      return refStr;
    }

    function selectedIban(){
      const keuze = document.querySelector('input[name="rekeningKeuze"]:checked')?.value || 'leidingskas';
      if (keuze === 'leidingskas') return LEIDINGSKAS_IBAN;
      const custom = document.getElementById('ibanCustom')?.value?.trim() || '';
      return custom;
    }

    function updateIbanUI(){
      const keuze = document.querySelector('input[name="rekeningKeuze"]:checked')?.value || 'leidingskas';
      const customWrap = document.getElementById('ibanCustomWrap');
      if (customWrap) customWrap.style.display = (keuze === 'custom') ? 'block' : 'none';
      const custom = document.getElementById('ibanCustom');
      if (custom) custom.required = (keuze === 'custom');
    }

    // Auth guard: alleen financieel
    firebase.auth().onAuthStateChanged(async (user)=>{
      const login = document.getElementById('loginBlock');
      const page  = document.getElementById('page');
      if (!user){ login.style.display='block'; page.style.display='none'; return; }
      try {
        const snap = await db.collection('gebruikers').doc(user.uid).get();
        const data = snap.exists ? snap.data() : {};
        if (data.rol !== 'financieel'){
          alert('Deze pagina is enkel voor financieel.');
          location.href = 'index.html';
          return;
        }
        // Prefill
        // Contact e-mail optioneel voor verzenden: laat leeg, maar mag vooraf ingevuld worden met eigen e-mail indien gewenst
        document.getElementById('contactEmail').value = '';
        document.getElementById('contactPhone').value = '';
        // Activeer standaard Leidingskas rekening
        const r = document.querySelector('input[name="rekeningKeuze"][value="leidingskas"]');
        if (r) r.checked = true; updateIbanUI();
  // Lokale referentie (geen Firestore permissies nodig)
  generateLocalReference();
        // Navbar tonen + role-based links consistent met index
        const nav = document.getElementById('mainNav');
        if (nav) nav.style.display = 'flex';
        const navSam = document.getElementById('navSamenvatting');
        const navBeh = document.getElementById('navBeheer');
        const navEven = document.getElementById('navEvenementen');
        const navOnk = document.getElementById('navOnkostennota');
        const navExport = document.getElementById('navExportPdf');
        const navTheme = document.getElementById('navTheme');
        const navLogout = document.getElementById('navLogout');
        const isFin = data.rol === 'financieel';
        if (navSam) navSam.style.display = isFin ? 'inline' : 'none';
        if (navBeh) navBeh.style.display = isFin ? 'inline' : 'none';
        const hasEventRoles = !!(data && data.evenementen && Object.values(data.evenementen).some(Boolean));
        if (navEven) navEven.style.display = (isFin || hasEventRoles) ? 'inline' : 'none';
  // Deze pagina heeft geen export handler; verberg exportknop hier
  if (navExport) navExport.style.display = 'none';
        if (navOnk) navOnk.style.display = isFin ? 'inline' : 'none';
        if (navLogout) navLogout.style.display = 'inline';
        if (navTheme) { navTheme.style.display = 'inline'; navTheme.textContent = document.body.dataset.theme === 'light' ? 'üåû' : 'üåô'; }

        login.style.display='none'; page.style.display='block';
      } catch (e){ console.error(e); alert('Kon gebruikersrechten niet laden.'); location.href='index.html'; }
    });

    async function handleLogin(){
      const em = document.getElementById('loginEmail').value.trim();
      const pw = document.getElementById('loginPass').value;
      const fout = document.getElementById('loginFout');
      fout.textContent = '';
      try { await firebase.auth().signInWithEmailAndPassword(em, pw); }
      catch(err){ fout.textContent = err?.message || 'Login mislukt.'; }
    }

    // Logo verwijderd op verzoek ‚Äì header enkel titel + adreslijn

    function formatDateNL(iso){
      try { const d = new Date(iso); return `${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${d.getFullYear()}`; } catch { return iso; }
    }

    function collectRows(){
      const rows = [];
      document.querySelectorAll('#regelsBody tr').forEach((tr, i)=>{
        const oms = (tr.querySelector('.r-oms')?.value || '').trim();
        const b = parseEuro((tr.querySelector('.r-bedrag')?.value || '').trim());
        if (oms && !isNaN(b)) rows.push({ nr: i+1, omschrijving: oms, bedrag: b });
      });
      return rows;
    }

    // Console warning suppressor: verwijder alleen bekende cosmetische warnings van autotable
    (function(){
      const ow = console.warn;
      console.warn = function(...a){
        if (a && a[0] && typeof a[0]==='string' && /Of the table content.*could not fit page/i.test(a[0])) return; // autoTable width waarschuwing
        return ow.apply(this,a);
      };
    })();

    function updateTotalsUI(){
      const rows = collectRows();
      const totaal = rows.reduce((s,r)=> s + (r.bedrag||0), 0);
      const badge = document.getElementById('totaalBadge');
      if (badge) badge.textContent = formatEuro(totaal);
      const genBtn = document.getElementById('genPdf');
      const mailBtn = document.getElementById('btnEmail');
      const naam = document.getElementById('betaler')?.value.trim();
      const valid = naam && rows.length>0 && totaal>0;
      if (genBtn) genBtn.disabled = !valid;
      if (mailBtn) mailBtn.disabled = !valid;
    }

    function addRow(pref={}){
      const body = document.getElementById('regelsBody');
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input type="text" class="r-oms" placeholder="Omschrijving" value="${pref.omschrijving || ''}" required></td>
        <td><input type="text" class="r-bedrag" inputmode="decimal" pattern="^\\d+(?:[\\.,]\\d{1,2})?$" placeholder="bv. 12,30" value="${pref.bedrag || ''}" required></td>
        <td><button type="button" class="btn sm del">üóëÔ∏è</button></td>`;
      tr.querySelector('.del').addEventListener('click', ()=> { tr.remove(); updateTotalsUI(); });
      tr.querySelector('.r-bedrag').addEventListener('input', ()=> updateTotalsUI());
      tr.querySelector('.r-oms').addEventListener('input', ()=> updateTotalsUI());
      body.appendChild(tr);
      updateTotalsUI();
    }

    async function buildPdfBlob({ref, dnota, iban, email, phone, rows}){
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      // Header (zonder logo)
      doc.setFont('helvetica','bold'); doc.setFontSize(18); doc.text('Onkostennota', 105, 18, { align:'center' });
      doc.setFont('helvetica','normal'); doc.setFontSize(10); doc.text(`${CHIRO_NAAM} ‚Äî ${CHIRO_ADRES}`, 105, 26, { align:'center' });

      // Gegevens (naam wordt onderaan vermeld, items in tabel)
      const naam = document.getElementById('betaler').value.trim();
      if (!naam) throw new Error('Vul de naam van de betaler in.');

      // Due date: 14 dagen na dnota
      const d = new Date(dnota);
      const verval = new Date(d.getTime() + 14*24*60*60*1000);
      const vervalStrISO = verval.toISOString().slice(0,10);
      const dnotaNL = formatDateNL(dnota);
      const vervalNL = formatDateNL(vervalStrISO);

      // Info blok (zoals voorbeeld): Referentie, Factuurdatum, Vervaldatum
      let y = 38;
      doc.autoTable({
        startY: y,
        theme: 'plain',
        styles: { font: 'helvetica', fontSize: 10, cellPadding: 2 },
        columnStyles: { 0: { fontStyle: 'bold', cellWidth: 38 }, 1: { cellWidth: 60 }, 2: { fontStyle: 'bold', cellWidth: 38 }, 3: { cellWidth: 60 } },
        body: [
          ['Referentie', ref, 'Factuurdatum', dnotaNL],
          ['Vervaldatum', vervalNL, 'Betaling naar', iban]
        ]
      });
      y = (doc.lastAutoTable && doc.lastAutoTable.finalY) ? doc.lastAutoTable.finalY + 8 : y + 20;

      // Items tabel (#, Omschrijving, Bedrag)
      const bodyRows = rows.map((r,i)=> [String(i+1), r.omschrijving, formatEuro(r.bedrag)]);
      const totaal = rows.reduce((s,r)=> s + (r.bedrag||0), 0);
      doc.autoTable({
        startY: y,
        head: [['#','Omschrijving','Bedrag']],
        body: bodyRows,
        theme: 'grid',
        styles: { font: 'helvetica', fontSize: 11, cellPadding: 2 },
        headStyles: { fillColor: [38,38,38] },
        columnStyles: {
          0: { cellWidth: 10 },
          1: { cellWidth: 120 },
          2: { cellWidth: 40, halign: 'right' }
        },
        didDrawPage: (d)=>{
          // Geen warning laten ontstaan door overflow: verklein indien nodig
          if (d.pageNumber > 1) doc.setFontSize(9);
        }
      });
      y = (doc.lastAutoTable && doc.lastAutoTable.finalY) ? doc.lastAutoTable.finalY + 6 : y + 24;

      // Totaal blok
      doc.setFont('helvetica','bold');
      doc.text('Totaal', 150, y);
      doc.text(formatEuro(totaal), 198 - 12, y, { align: 'right' });
      y += 12;

  // Betaalopmerking (duidelijker in grijze box)
  y += 4; // kleine spatie
  doc.setFontSize(11); doc.setFont('helvetica','bold');
  const betaalTxt = `Gelieve binnen 14 dagen te betalen op ${iban} met vermelding van referentie ${ref}.`;
  const betaalLines = doc.splitTextToSize(betaalTxt, 180);
  const boxH = betaalLines.length * 6 + 6;
  const boxY = y;
  doc.setFillColor(240,240,240); doc.roundedRect(10, boxY, 190-20, boxH, 2,2,'F');
  doc.setTextColor(0); doc.text(betaalLines, 14, boxY + 10 - 6); // align binnen box
  y = boxY + boxH + 8; // extra ruimte erna

  // Contactinfo iets lager
  doc.setFont('helvetica','normal'); doc.setFontSize(10);
  if (email) { doc.text(`Contact e-mail: ${email}`, 12, y); y += 6; }
  if (phone) { doc.text(`Contact telefoon: ${phone}`, 12, y); y += 6; }
  doc.text(`Naam betaler: ${naam}`, 12, y);

      const blob = doc.output('blob');
      return blob;
    }

    async function saveKostennotaAndUpload({download=false}={}){
  const ref = document.getElementById('referentie').value || generateLocalReference();
      const naam = document.getElementById('betaler').value.trim();
      const dnota = document.getElementById('datumNota').value || new Date().toISOString().slice(0,10);
      const email = document.getElementById('contactEmail').value.trim();
      const phone = document.getElementById('contactPhone').value.trim();
      const iban = selectedIban();
      const rows = collectRows();
      if (!rows.length) throw new Error('Voeg minstens √©√©n kostregel toe.');
      const totaal = rows.reduce((s,r)=> s + (r.bedrag||0), 0);

      // Validaties
      const keuze = document.querySelector('input[name="rekeningKeuze"]:checked')?.value || 'leidingskas';
      if (keuze === 'custom' && !(iban && iban.length >= 12)) throw new Error('Vul een geldig eigen rekeningnummer (IBAN) in.');
      if (!naam || !dnota || !iban) throw new Error('Vul Naam, Datum en Rekeningnummer in.');

      // PDF maken (blob)
      const blob = await buildPdfBlob({ref, dnota, iban, email, phone, rows});

      // Upload overslaan op niet‚Äëvertrouwde hosts om CORS fouten te vermijden
      const TRUSTED_HOSTS = ['localhost','127.0.0.1', 'uitgavebeheerch.web.app', 'uitgavebeheerch.firebaseapp.com'];
      const host = (location && location.hostname) || '';
      let pdfUrl = '';
      if (TRUSTED_HOSTS.includes(host)) {
        try {
          if (!firebase.storage) throw new Error('Storage SDK niet geladen.');
          const storage = firebase.storage();
          const rootRef = storage.ref();
          const fileRef = rootRef.child(`kostennota/${ref}.pdf`);
          try { await firebase.auth().currentUser?.getIdToken(true); } catch {}
          const snap = await fileRef.put(blob, { contentType: 'application/pdf' });
          pdfUrl = await snap.ref.getDownloadURL();
        } catch(e){
          // Stil fallback naar lokale download zonder console errors
          const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `Onkostennota-${ref}.pdf`; a.click(); a.remove();
          pdfUrl = null;
        }
      } else {
        // Directe lokale download (geen upload poging)
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `Onkostennota-${ref}.pdf`; a.click(); a.remove();
        pdfUrl = null;
      }

      // Opslaan naar Firestore alleen als permissies aanwezig (stil falen anders)
      const uid = firebase.auth().currentUser?.uid || null;
      try {
        const data = {
          ref, naam, dnota, iban,
          email: email || null,
          phone: phone || null,
          rows,
          totaal: Number(totaal.toFixed(2)),
          createdBy: uid,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          pdfUrl: pdfUrl || null,
          localOnly: !pdfUrl
        };
        await firebase.firestore().collection('kostennota').doc(ref).set(data, { merge: true });
      } catch(writeErr){
        console.warn('[KOSTENNOTA] Kon Firestore record niet schrijven (permissies?):', writeErr);
      }

      if (download && pdfUrl){
        const a = document.createElement('a');
        a.href = pdfUrl; a.download = `Onkostennota-${ref}.pdf`; a.target = '_blank';
        document.body.appendChild(a); a.click(); a.remove();
      }
      return { ref, pdfUrl, totaal, dnota, iban };
    }

    async function openEmailDraft(){
      // Zorg dat pdf ge√ºpload en opgeslagen is
      let saved;
      try { saved = await saveKostennotaAndUpload({ download: false }); }
      catch(e){ alert(e.message || String(e)); return; }
      const { ref, pdfUrl, totaal, dnota, iban } = saved;
      const naam = document.getElementById('betaler').value.trim();
      const emailTo = document.getElementById('contactEmail').value.trim();
      const d = new Date(dnota); const verval = new Date(d.getTime() + 14*24*60*60*1000); const vervalStr = verval.toISOString().slice(0,10);
      const subject = encodeURIComponent(`Onkostennota ${ref} ‚Äì ${CHIRO_NAAM}`);
      const lines = [
        `Beste ${naam || ''},`,
        '',
        `Hierbij de onkostennota met referentie ${ref}.`,
        `Gelieve ${formatEuro(totaal)} over te schrijven naar ${iban} met vermelding van referentie ${ref}.`,
        `Betaaltermijn: uiterlijk ${vervalStr} (14 dagen na ${dnota}).`,
        '',
        `Je kan de kostennota hier downloaden: ${pdfUrl}`,
        '',
        `Met vriendelijke groet,`,
        `${CHIRO_NAAM}`,
        `${CHIRO_ADRES}`
      ];
      const body = encodeURIComponent(lines.join('\n'));
      const to = emailTo || '';
      const mailto = `mailto:${to}?subject=${subject}&body=${body}`;
      window.location.href = mailto;
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      // Ensure theme applied when DOM is ready
      applyTheme(localStorage.getItem('theme') || 'dark');
      // UI handlers
      document.getElementById('genPdf').addEventListener('click', async ()=>{
        const status = document.getElementById('genStatus');
        if (status) { status.style.color='#60a5fa'; status.textContent='Bezig met genereren...'; }
        try {
          const result = await saveKostennotaAndUpload({ download: true });
          if (status) {
            status.style.color = '#22c55e';
            status.textContent = result.pdfUrl ? 'PDF opgeslagen & gedownload.' : 'PDF lokaal gedownload (upload niet gelukt).';
          }
        } catch(e){
          alert(e.message || String(e));
          if (status) { status.style.color='#ef4444'; status.textContent=e.message || String(e); }
        } finally { setTimeout(()=>{ const s=document.getElementById('genStatus'); if(s) s.textContent=''; }, 5000); }
      });
      document.querySelectorAll('input[name="rekeningKeuze"]').forEach(el=> el.addEventListener('change', updateIbanUI));
      document.getElementById('navLogout').addEventListener('click', ()=> firebase.auth().signOut().then(()=> location.href='index.html'));
      // Init rekening UI
      updateIbanUI();
      document.getElementById('btnEmail').addEventListener('click', async ()=>{
        const status = document.getElementById('genStatus');
        if (status) { status.style.color='#60a5fa'; status.textContent='Upload & e-mail voorbereiden...'; }
  await openEmailDraft();
  if (status) { status.style.color='#22c55e'; status.textContent='E-mail geopend (let op: PDF mogelijk lokaal).'; setTimeout(()=>{ status.textContent=''; }, 6000); }
      });
      // Default datum = vandaag
      const dn = document.getElementById('datumNota');
      if (dn && !dn.value) dn.value = new Date().toISOString().slice(0,10);
      // Theme toggle
      const navTheme = document.getElementById('navTheme');
      if (navTheme) navTheme.addEventListener('click', async ()=>{
        const current = document.body.dataset.theme || localStorage.getItem('theme') || 'dark';
        const next = current === 'dark' ? 'light' : 'dark';
        applyTheme(next); await saveThemePreference(next); navTheme.textContent = next==='light' ? 'üåû' : 'üåô';
      });
      // Start met √©√©n lege regel
      addRow();
  const btnAdd = document.getElementById('btnAddRow');
  if (btnAdd) btnAdd.addEventListener('click', ()=> addRow());
  const btnClear = document.getElementById('btnClearRows');
  if (btnClear) btnClear.addEventListener('click', ()=> { document.getElementById('regelsBody').innerHTML=''; addRow(); updateTotalsUI(); });
  const betaler = document.getElementById('betaler');
  if (betaler) betaler.addEventListener('input', updateTotalsUI);
  updateTotalsUI();
    });
  </script>

  <style>
    .container { max-width: 1000px; margin: 0 auto; padding: 1rem; }
    .card { background: var(--card-bg, rgba(255,255,255,0.04)); border-radius: 12px; padding: 1rem; box-shadow: 0 8px 24px rgba(0,0,0,0.2); }
    .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .form-grid .full { grid-column: 1 / -1; }
    .btn { padding: 10px 14px; border: 0; border-radius: 8px; background: #2563eb; color: #fff; cursor: pointer; }
    .btn.sm { padding: 6px 10px; font-size: 0.9rem; background: #4b5563; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border-bottom: 1px solid rgba(255,255,255,0.08); padding: 8px; }
    .actions { display: flex; gap: 8px; }
    @media (max-width: 800px) { .form-grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <nav id="mainNav" style="display:none;">
    <span>Chiro Kattenbos</span>
    <a href="index.html">Home</a>
    <a id="navSamenvatting" href="samenvatting.html" target="_blank">Samenvatting</a>
    <a id="navEvenementen" href="evenementen.html">Evenementen</a>
    <a id="navBeheer" href="gebruikersbeheer.html">Gebruikersbeheer</a>
    <a id="navOnkostennota" href="onkostennota.html" style="display:none;">Onkostennota</a>
    <button id="navTheme" title="Schakel thema" style="display:none;">üåô</button>
    <button id="navExportPdf" class="push-right">Export PDF</button>
    <button id="navLogout">Uitloggen</button>
  </nav>

  <div class="container">
    <!-- Login fallback -->
    <div id="loginBlock" class="card" style="display:none;">
      <h2>Inloggen</h2>
      <div class="form-grid">
        <input type="email" id="loginEmail" placeholder="E-mailadres" />
        <input type="password" id="loginPass" placeholder="Wachtwoord" />
        <button class="btn" onclick="handleLogin()">Inloggen</button>
        <p id="loginFout" class="full" style="color:#ef4444;"></p>
      </div>
    </div>

    <!-- Pagina -->
    <div id="page" style="display:none;">
      <div class="card" style="margin-bottom:1rem;">
        <h1 style="margin:0 0 .5rem 0; display:flex; align-items:center; gap:10px;">
          <img id="logo" src="chiro-logo.png" alt="Chiro logo" style="width:32px; height:32px; object-fit:contain;" />
          Onkostennota
        </h1>
  <p>Vul de gegevens in en klik op Genereren. De kostennota vermeldt automatisch dat we Chiro Kattenbos zijn, ons adres en een betaaltermijn van 14 dagen.</p>
      </div>

      <div class="card" style="margin-bottom:1rem;">
        <div class="form-grid">
          <input type="text" id="betaler" class="full" placeholder="Voor- en achternaam betaler" />
          <input type="text" id="omschrijving" class="full" placeholder="Algemene reden / omschrijving (optioneel)" />
          <input type="date" id="datumNota" />
          <input type="text" id="referentie" class="full" placeholder="Referentie (automatisch)" readonly />

          <div class="full" style="display:flex; gap:14px; align-items:center; flex-wrap:wrap;">
            <label style="margin-right:10px;">Rekeningnummer:</label>
            <label><input type="radio" name="rekeningKeuze" value="leidingskas" checked> BE38 7350 3401 6672</label>
            <label><input type="radio" name="rekeningKeuze" value="custom"> Eigen rekeningnummer</label>
          </div>
          <div id="ibanCustomWrap" class="full" style="display:none;">
            <input type="text" id="ibanCustom" placeholder="IBAN (BE00 0000 0000 0000)" />
          </div>
        </div>
      </div>

      <div class="card" style="margin-bottom:1rem;">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:14px; flex-wrap:wrap; margin-bottom:.75rem;">
          <h3 style="margin:0; display:flex; align-items:center; gap:8px;">Kosten <span id="totaalBadge" style="font-size:.8rem; background:rgba(96,165,250,.15); color:#60a5fa; padding:4px 8px; border-radius:20px; letter-spacing:.5px;">‚Ç¨0,00</span></h3>
          <div style="display:flex; gap:8px;">
            <button class="btn sm" type="button" id="btnAddRow">+ Regel</button>
            <button class="btn sm" type="button" id="btnClearRows" style="background:#dc2626;">Leeg</button>
          </div>
        </div>
        <div class="table-scroll">
          <table style="width:100%;">
            <thead>
              <tr>
                <th style="text-align:left;">Omschrijving</th>
                <th style="text-align:right; width:160px;">Bedrag (‚Ç¨)</th>
                <th style="width:70px;">Actie</th>
              </tr>
            </thead>
            <tbody id="regelsBody"></tbody>
          </table>
        </div>
        <p id="kostenHint" style="margin:.6rem 0 0; font-size:.8rem; opacity:.75;">Gebruik komma of punt voor decimalen. Laat leeg of verwijder rij als je ze niet nodig hebt.</p>
      </div>

      <div class="card" style="margin-bottom:1rem;">
        <h3 style="margin-top:0;">Verzenden (optioneel)</h3>
        <div class="form-grid">
          <input type="email" id="contactEmail" placeholder="E-mailadres ontvanger" />
          <input type="tel" id="contactPhone" placeholder="Telefoonnummer ontvanger" />
        </div>
        <div class="actions" style="margin-top:14px; display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
          <button class="btn" id="genPdf" disabled>Genereren PDF</button>
          <button class="btn sm" type="button" id="btnEmail" disabled>Maak e-mail</button>
          <span style="opacity:.75; font-size:.8rem; max-width:340px;">De e-mail opent je eigen mailprogramma. Eerst wordt het PDF-bestand veilig opgeslagen.</span>
          <span id="genStatus" style="font-size:.75rem; letter-spacing:.5px; color:#60a5fa;"></span>
        </div>
      </div>
    </div>
  </div>
</body>
<!-- Service worker registration removed to avoid 404 when file is not present on this path -->
</html>











